import{x as y,y as u,_ as A,B as _,A as U,a as k,c as p,w as S,u as w,r as c,o,b as s,d as B,i as n,k as v,l as x,t as l,f as C}from"./main-BpEgt2VT.js";const E=y("users",{state:()=>({users:[],loading:!1,error:null}),getters:{adminUsers:r=>r.users.filter(e=>e.role==="admin"),regularUsers:r=>r.users.filter(e=>e.role==="user")},actions:{async fetchAllUsers(){this.loading=!0,this.error=null;try{const r=await u.getAllUsers();return this.users=r.data,this.users}catch(r){return console.error("Error fetching users:",r),r.response&&r.response.status===403?this.error="Access denied. Admin privileges required.":r.response&&r.response.data?(this.error=r.response.data.error||"Failed to load users",r.response.data.details&&(this.error+=`. Details: ${r.response.data.details}`)):this.error="An error occurred loading users",[]}finally{this.loading=!1}},async deleteUser(r){this.loading=!0,this.error=null;try{return await u.deleteUser(r),this.users=this.users.filter(e=>e.id!==r),!0}catch(e){return console.error(`Error deleting user ${r}:`,e),e.response&&e.response.data?this.error=e.response.data.error||`Failed to delete user ${r}`:this.error="An error occurred while deleting the user",!1}finally{this.loading=!1}},async updateUserProfile(r){this.loading=!0,this.error=null;try{const e=await u.updateProfile(r),a=this.users.findIndex(h=>h.id===r.id);return a!==-1&&(this.users[a]={...this.users[a],...e.data}),e.data}catch(e){return console.error("Error updating profile:",e),e.response&&e.response.data?this.error=e.response.data.error||"Failed to update profile":this.error="An error occurred updating profile",null}finally{this.loading=!1}}}}),N={name:"AdminView",components:{BaseLayout:k,AlertMessage:U,Button:_},setup(){const r=E(),e=w();return{userStore:r,authStore:e}},data(){return{loading:!1,error:null}},computed:{users(){return this.userStore.users},isAdmin(){return this.authStore.isAdmin}},created(){this.loadUsers()},methods:{async loadUsers(){this.loading=!0,this.error=null;try{await this.userStore.fetchAllUsers(),this.userStore.error&&(this.error=this.userStore.error)}catch(r){console.error("Error loading users:",r),this.error="An unexpected error occurred loading users"}finally{this.loading=!1}},async deleteUser(r){try{!await this.userStore.deleteUser(r)&&this.userStore.error&&(this.error=this.userStore.error)}catch(e){console.error("Error deleting user:",e),this.error="An unexpected error occurred while deleting the user"}}}},b={class:"admin-dashboard"},L={key:1,class:"loading"},V={key:2,class:"admin-panel"},D={class:"user-list"},F={key:0},M={key:1};function P(r,e,a,h,i,d){const f=c("AlertMessage"),g=c("Button"),m=c("BaseLayout");return o(),p(m,null,{default:S(()=>[s("div",b,[e[2]||(e[2]=s("h1",null,"Admin Dashboard",-1)),i.error?(o(),p(f,{key:0,type:"danger",message:i.error},null,8,["message"])):B("",!0),i.loading?(o(),n("div",L,"Loading user data...")):(o(),n("div",V,[e[1]||(e[1]=s("h2",null,"User Management",-1)),s("div",D,[d.users.length?(o(),n("table",F,[e[0]||(e[0]=s("thead",null,[s("tr",null,[s("th",null,"ID"),s("th",null,"Username"),s("th",null,"Email"),s("th",null,"Role"),s("th",null,"Credit Card"),s("th",null,"Reset Token"),s("th",null,"Actions")])],-1)),s("tbody",null,[(o(!0),n(v,null,x(d.users,t=>(o(),n("tr",{key:t.id},[s("td",null,l(t.id),1),s("td",null,l(t.username),1),s("td",null,l(t.email),1),s("td",null,l(t.role),1),s("td",null,l(t.creditCardNumber||"N/A"),1),s("td",null,l(t.resetToken||"N/A"),1),s("td",null,[C(g,{onClick:R=>d.deleteUser(t.id),variant:"danger",text:"Delete"},null,8,["onClick"])])]))),128))])])):(o(),n("div",M,"No users found"))])]))])]),_:1})}const $=A(N,[["render",P],["__scopeId","data-v-650cec73"]]);export{$ as default};
