import{_ as I,A as b,F as H,B as M,a as N,c as P,w as u,s as T,p as x,r as g,o as i,b as t,i as a,d as D,f as l,g as c,v as k,t as p,e as E,k as w,l as C,m as y,n as j}from"./main-BpEgt2VT.js";const L={name:"TasksView",components:{BaseLayout:N,Button:M,FormGroup:H,AlertMessage:b},data(){return{tasks:[],projects:[],projectMap:{},loading:!0,error:null,searchTerm:"",showTaskForm:!1,isEditMode:!1,editTaskId:null,showDeleteConfirm:!1,taskToDelete:null,taskForm:{title:"",description:"",projectId:"",status:"Not Started",priority:"Medium",dueDate:"",estimatedHours:null,actualHours:null,assignedTo:null,isCompleted:!1},errors:{}}},computed:{filteredTasks(){if(!this.searchTerm)return this.tasks;const s=this.searchTerm.toLowerCase();return this.tasks.filter(e=>e.title.toLowerCase().includes(s)||e.description&&e.description.toLowerCase().includes(s)||e.status.toLowerCase().includes(s)||e.priority&&e.priority.toLowerCase().includes(s)||this.getProjectName(e.projectId)&&this.getProjectName(e.projectId).toLowerCase().includes(s))}},methods:{openNewTaskModal(){this.isEditMode=!1,this.editTaskId=null,this.resetTaskForm(),this.showTaskForm=!0},openEditModal(s){this.isEditMode=!0,this.editTaskId=s.id;const e=n=>{if(!n)return"";const h=new Date(n);return isNaN(h.getTime())?"":h.toISOString().split("T")[0]};this.taskForm={title:s.title||"",description:s.description||"",projectId:s.projectId||"",status:s.status||"Not Started",priority:s.priority||"Medium",dueDate:e(s.dueDate),estimatedHours:s.estimatedHours||null,actualHours:s.actualHours||null,assignedTo:s.assignedTo||null,isCompleted:s.isCompleted||!1},console.log("Editing task:",s.id,this.taskForm),this.showTaskForm=!0},closeTaskForm(){this.showTaskForm=!1,this.isEditMode=!1,this.editTaskId=null,this.errors={}},async fetchTasks(){var s;this.loading=!0,this.error=null;try{const e=await T.getAllTasks();console.log(`Received ${((s=e.data)==null?void 0:s.length)||0} tasks from API`),this.tasks=Array.isArray(e.data)?e.data.map(n=>({...n,dueDate:n.dueDate?n.dueDate:null})):[],this.tasks.length===0?console.log("No tasks found or empty array returned"):console.log(`Successfully loaded ${this.tasks.length} tasks`)}catch(e){console.error("Error fetching tasks:",e),this.error="Failed to load tasks. Please try again."}finally{this.loading=!1}},async fetchProjects(){try{const s=await x.getAllProjects();this.projects=s.data||[],this.projectMap={},this.projects.forEach(e=>{this.projectMap[e.id]=e.name})}catch(s){console.error("Error fetching projects:",s)}},async submitTaskForm(){this.errors={};try{const s={...this.taskForm,dueDate:this.taskForm.dueDate?this.taskForm.dueDate:null,projectId:parseInt(this.taskForm.projectId)||null,estimatedHours:this.taskForm.estimatedHours?parseInt(this.taskForm.estimatedHours):null,actualHours:this.taskForm.actualHours?parseInt(this.taskForm.actualHours):null,assignedTo:this.taskForm.assignedTo?parseInt(this.taskForm.assignedTo):null};if(console.log("Submitting task form data:",s),this.isEditMode&&this.editTaskId){console.log(`Updating task with ID ${this.editTaskId}`);const e=await T.updateTask(this.editTaskId,s),n=this.tasks.findIndex(h=>h.id===this.editTaskId);n!==-1?(this.tasks.splice(n,1,e.data),console.log("Task updated in list at index:",n)):(console.warn("Task not found in list after update"),await this.fetchTasks()),console.log("Task updated:",e.data)}else{const e=await T.createTask(s);this.tasks.unshift(e.data),console.log("Task created:",e.data)}this.closeTaskForm()}catch(s){console.error(`Error ${this.isEditMode?"updating":"creating"} task:`,s),s.response&&s.response.data&&(this.errors=s.response.data.errors||{})}},resetTaskForm(){const s=new Date;s.setDate(s.getDate()+7);const e=n=>n.toISOString().split("T")[0];this.taskForm={title:"",description:"",projectId:this.projects.length>0?this.projects[0].id:"",status:"Not Started",priority:"Medium",dueDate:e(s),estimatedHours:null,actualHours:null,assignedTo:null,isCompleted:!1}},viewProject(s){this.$router.push(`/projects/${s}`)},confirmDeleteTask(s){this.taskToDelete=s,this.showDeleteConfirm=!0},async deleteTask(){try{await T.deleteTask(this.taskToDelete.id),this.tasks=this.tasks.filter(s=>s.id!==this.taskToDelete.id),this.showDeleteConfirm=!1,this.taskToDelete=null}catch(s){console.error("Error deleting task:",s),this.error="Failed to delete task. Please try again."}},formatDate(s){return s?new Date(s).toLocaleDateString():""},getProjectName(s){return this.projectMap[s]||""}},created(){this.fetchProjects().then(()=>{this.fetchTasks()}),this.resetTaskForm()}},S={class:"tasks-view"},V={class:"actions-bar"},A={class:"search-box"},U={key:0,class:"modal"},B={class:"modal-content"},O=["value"],G={class:"form-row"},q={class:"form-row"},z={class:"form-actions"},R={key:1,class:"loading"},W={key:2,class:"error"},J={key:3,class:"no-tasks"},K={key:4,class:"tasks-table-container"},Q={class:"tasks-table"},X={class:"task-name-cell"},Y={class:"task-name"},Z=["innerHTML"],$={class:"project-cell"},ee=["onClick"],te={key:1,class:"not-assigned"},se={class:"status-cell"},oe={class:"priority-cell"},re={class:"date-cell"},ie={key:0,class:"date-info"},ae={key:1},le={class:"actions-cell"},ne=["onClick"],de=["onClick"],ue={key:5,class:"modal"},ce={class:"modal-content"},me={class:"modal-actions"};function pe(s,e,n,h,r,d){const f=g("Button"),m=g("FormGroup"),_=g("BaseLayout");return i(),P(_,null,{default:u(()=>{var F;return[t("div",S,[e[24]||(e[24]=t("h1",null,"Tasks",-1)),t("div",V,[l(f,{onClick:e[0]||(e[0]=o=>d.openNewTaskModal()),variant:"primary",text:"New Task"}),t("div",A,[c(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>r.searchTerm=o),placeholder:"Search tasks..."},null,512),[[k,r.searchTerm]])])]),r.showTaskForm?(i(),a("div",U,[t("div",B,[t("h2",null,p(r.isEditMode?"Edit Task":"Create New Task"),1),t("form",{onSubmit:e[12]||(e[12]=E((...o)=>d.submitTaskForm&&d.submitTaskForm(...o),["prevent"]))},[l(m,{label:"Title",error:r.errors.title},{default:u(()=>[c(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>r.taskForm.title=o),required:""},null,512),[[k,r.taskForm.title]])]),_:1},8,["error"]),l(m,{label:"Description",error:r.errors.description},{default:u(()=>[c(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.taskForm.description=o),rows:"3"},null,512),[[k,r.taskForm.description]])]),_:1},8,["error"]),l(m,{label:"Project",error:r.errors.projectId},{default:u(()=>[c(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.taskForm.projectId=o),required:""},[e[15]||(e[15]=t("option",{value:"",disabled:""},"Select a project",-1)),(i(!0),a(w,null,C(r.projects,o=>(i(),a("option",{key:o.id,value:o.id},p(o.name),9,O))),128))],512),[[y,r.taskForm.projectId]])]),_:1},8,["error"]),t("div",G,[l(m,{label:"Status"},{default:u(()=>[c(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.taskForm.status=o)},e[16]||(e[16]=[t("option",{value:"Not Started"},"Not Started",-1),t("option",{value:"In Progress"},"In Progress",-1),t("option",{value:"On Hold"},"On Hold",-1),t("option",{value:"Complete"},"Complete",-1)]),512),[[y,r.taskForm.status]])]),_:1}),l(m,{label:"Priority"},{default:u(()=>[c(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.taskForm.priority=o)},e[17]||(e[17]=[t("option",{value:"Low"},"Low",-1),t("option",{value:"Medium"},"Medium",-1),t("option",{value:"High"},"High",-1),t("option",{value:"Critical"},"Critical",-1)]),512),[[y,r.taskForm.priority]])]),_:1})]),l(m,{label:"Due Date"},{default:u(()=>[c(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=o=>r.taskForm.dueDate=o)},null,512),[[k,r.taskForm.dueDate]])]),_:1}),t("div",q,[l(m,{label:"Estimated Hours",error:r.errors.estimatedHours},{default:u(()=>[c(t("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=o=>r.taskForm.estimatedHours=o),min:"0"},null,512),[[k,r.taskForm.estimatedHours]])]),_:1},8,["error"]),l(m,{label:"Actual Hours",error:r.errors.actualHours},{default:u(()=>[c(t("input",{type:"number","onUpdate:modelValue":e[9]||(e[9]=o=>r.taskForm.actualHours=o),min:"0"},null,512),[[k,r.taskForm.actualHours]])]),_:1},8,["error"])]),l(m,{label:"Assigned To",error:r.errors.assignedTo},{default:u(()=>[c(t("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=o=>r.taskForm.assignedTo=o),placeholder:"User ID"},null,512),[[k,r.taskForm.assignedTo]])]),_:1},8,["error"]),t("div",z,[l(f,{type:"submit",variant:"primary",text:r.isEditMode?"Update Task":"Create Task"},null,8,["text"]),l(f,{onClick:e[11]||(e[11]=o=>d.closeTaskForm()),variant:"secondary",text:"Cancel"})])],32)])])):D("",!0),r.loading?(i(),a("div",R,"Loading tasks...")):r.error?(i(),a("div",W,p(r.error),1)):d.filteredTasks.length===0?(i(),a("div",J,e[18]||(e[18]=[t("p",null,"No tasks found. Create your first task!",-1)]))):(i(),a("div",K,[t("table",Q,[e[22]||(e[22]=t("thead",null,[t("tr",null,[t("th",null,"Task"),t("th",null,"Project"),t("th",null,"Status"),t("th",null,"Priority"),t("th",null,"Due Date"),t("th",null,"Actions")])],-1)),t("tbody",null,[(i(!0),a(w,null,C(d.filteredTasks,o=>(i(),a("tr",{key:o.id,class:"task-row"},[t("td",X,[t("h3",Y,p(o.title),1),t("p",{class:"description",innerHTML:o.description},null,8,Z)]),t("td",$,[d.getProjectName(o.projectId)?(i(),a("span",{key:0,class:"project-link",onClick:v=>d.viewProject(o.projectId)},p(d.getProjectName(o.projectId)),9,ee)):(i(),a("span",te,"Not assigned"))]),t("td",se,[t("span",{class:j(["status-badge","status-"+o.status.toLowerCase().replace(" ","-")])},p(o.status),3)]),t("td",oe,[t("span",{class:j(["priority-badge","priority-"+(o.priority?o.priority.toLowerCase():"none")])},p(o.priority||"None"),3)]),t("td",re,[o.dueDate?(i(),a("div",ie,[e[19]||(e[19]=t("span",{class:"date-icon"},"ðŸ—“ï¸",-1)),t("span",null,p(d.formatDate(o.dueDate)),1)])):(i(),a("span",ae,"No due date"))]),t("td",le,[t("span",{class:"action-icon edit-icon",onClick:v=>d.openEditModal(o),title:"Edit Task"},e[20]||(e[20]=[t("i",{class:"fas fa-pen"},null,-1)]),8,ne),t("span",{class:"action-icon delete-icon",onClick:v=>d.confirmDeleteTask(o),title:"Delete Task"},e[21]||(e[21]=[t("i",{class:"fas fa-trash-alt"},null,-1)]),8,de)])]))),128))])])])),r.showDeleteConfirm?(i(),a("div",ue,[t("div",ce,[e[23]||(e[23]=t("h3",null,"Confirm Delete",-1)),t("p",null,'Are you sure you want to delete "'+p((F=r.taskToDelete)==null?void 0:F.title)+'"? This action cannot be undone.',1),t("div",me,[l(f,{onClick:e[13]||(e[13]=o=>d.deleteTask()),variant:"danger",text:"Delete"}),l(f,{onClick:e[14]||(e[14]=o=>r.showDeleteConfirm=!1),variant:"secondary",text:"Cancel"})])])])):D("",!0)])]}),_:1})}const he=I(L,[["render",pe],["__scopeId","data-v-27c3b0f9"]]);export{he as default};
