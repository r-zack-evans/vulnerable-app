import{_ as N,B as b,a as w,c as P,w as _,j as g,p as k,r as f,o as r,b as e,i as n,d as m,h as E,f as p,t as d,e as j,g as l,v as u,m as D,n as y,q as C,k as M,l as x}from"./main-BpEgt2VT.js";const I={name:"ProjectDetailView",components:{BaseLayout:w,Button:b},data(){return{project:{},tasks:[],loading:!0,error:null,tasksLoading:!0,tasksError:null,showDeleteConfirm:!1,isEditMode:!1,editForm:{name:"",description:"",startDate:"",endDate:"",status:"Not Started",completionPercentage:0,budget:0,clientNotes:"",internalNotes:""},showTaskModal:!1,editingTask:null,taskForm:{title:"",description:"",status:"Not Started",dueDate:"",assignedTo:""}}},computed:{projectId(){return this.$route.params.id}},watch:{"$route.params.id":function(i){i!==this.projectId&&(this.fetchProject(),this.fetchTasks())},"$route.path":function(i){this.isEditMode=i.includes("/edit"),this.isEditMode&&this.project.id&&this.populateEditForm()}},methods:{goBack(){this.$router.push("/projects")},async fetchProject(){this.loading=!0,this.error=null;try{const i=await k.getProject(this.projectId);this.project=i.data,console.log("Project loaded:",this.project),this.isEditMode&&this.populateEditForm()}catch(i){console.error("Error fetching project:",i),this.error=`Failed to load project: ${i.message}`}finally{this.loading=!1}},async fetchTasks(){this.tasksLoading=!0,this.tasksError=null;try{const i=await k.getProjectTasks(this.projectId);this.tasks=i.data,console.log(`Loaded ${this.tasks.length} tasks`)}catch(i){console.error("Error fetching tasks:",i),this.tasksError="Failed to load tasks. Please try again."}finally{this.tasksLoading=!1}},confirmDeleteProject(){this.showDeleteConfirm=!0},async deleteProject(){try{await k.deleteProject(this.projectId),this.$router.push("/projects")}catch(i){console.error("Error deleting project:",i),this.error="Failed to delete project. Please try again."}finally{this.showDeleteConfirm=!1}},formatDate(i){if(!i)return"Not set";try{return new Date(i).toLocaleDateString()}catch(t){return console.error("Error formatting date:",t),"Invalid date"}},formatDateForInput(i){if(!i)return"";try{const t=new Date(i);return isNaN(t.getTime())?"":t.toISOString().split("T")[0]}catch(t){return console.error("Error formatting date for input:",t),""}},enterEditMode(){this.$router.push(`/projects/${this.projectId}/edit`)},populateEditForm(){var i,t;this.editForm={name:this.project.name||"",description:this.project.description||"",startDate:this.formatDateForInput(this.project.startDate),endDate:this.formatDateForInput(this.project.endDate),status:this.project.status||"Not Started",completionPercentage:this.project.completionPercentage||0,budget:this.project.budget||0,clientNotes:((i=this.project.metadata)==null?void 0:i.clientNotes)||"",internalNotes:((t=this.project.metadata)==null?void 0:t.internalNotes)||""}},cancelEdit(){this.$router.push(`/projects/${this.projectId}`)},async saveProject(){try{const i={name:this.editForm.name,description:this.editForm.description,startDate:this.editForm.startDate||null,endDate:this.editForm.endDate||null,status:this.editForm.status,completionPercentage:parseInt(this.editForm.completionPercentage)||0,budget:parseFloat(this.editForm.budget)||0,metadata:{clientNotes:this.editForm.clientNotes,internalNotes:this.editForm.internalNotes}},t=await k.updateProject(this.projectId,i);this.project=t.data,this.$router.push(`/projects/${this.projectId}`)}catch(i){console.error("Error saving project:",i),this.error=`Failed to save project: ${i.message}`}},openNewTaskModal(){this.editingTask=null,this.taskForm={title:"",description:"",status:"Not Started",dueDate:this.formatDateForInput(new Date),assignedTo:""},this.showTaskModal=!0},editTask(i){this.editingTask=i.id,this.taskForm={title:i.title||"",description:i.description||"",status:i.status||"Not Started",dueDate:this.formatDateForInput(i.dueDate),assignedTo:i.assignedTo||""},this.showTaskModal=!0},closeTaskModal(){this.showTaskModal=!1,this.editingTask=null},async saveTask(){try{const i={title:this.taskForm.title,description:this.taskForm.description,status:this.taskForm.status,dueDate:this.taskForm.dueDate||null,assignedTo:this.taskForm.assignedTo||null,projectId:parseInt(this.projectId)};let t;if(this.editingTask){t=await g.put(`/tasks/${this.editingTask}`,i);const v=this.tasks.findIndex(h=>h.id===this.editingTask);v!==-1&&this.tasks.splice(v,1,t.data)}else t=await g.post(`/projects/${this.projectId}/tasks`,i),this.tasks.push(t.data);this.closeTaskModal()}catch(i){console.error("Error saving task:",i),this.tasksError=`Failed to save task: ${i.message}`}},async deleteTask(i){if(confirm("Are you sure you want to delete this task?"))try{await g.delete(`/tasks/${i}`),this.tasks=this.tasks.filter(t=>t.id!==i)}catch(t){console.error("Error deleting task:",t),this.tasksError="Failed to delete task. Please try again."}}},created(){this.isEditMode=this.$route.path.includes("/edit"),this.fetchProject(),this.fetchTasks(),console.log("Route params:",this.$route.params)}},L={class:"project-detail-view"},S={class:"project-header"},V=["innerHTML"],B={key:1},U={key:2,class:"project-actions"},H={key:0,class:"loading"},A={key:1,class:"error"},O={key:2,class:"not-found"},z={key:3,class:"edit-form-container"},q={class:"form-group"},R={class:"form-group"},G={class:"form-row"},J={class:"form-group"},K={class:"form-group"},Q={class:"form-row"},W={class:"form-group"},X={class:"form-group"},Y={class:"form-group"},Z={class:"form-section"},$={class:"form-group"},tt={class:"form-group"},et={class:"form-actions"},st={key:4,class:"project-content"},ot={class:"project-info-card"},it={class:"card-section"},rt=["innerHTML"],nt={class:"card-section status-section"},at={class:"status-info"},lt={class:"completion-info"},dt={class:"progress-bar"},ut={class:"card-section timeline-section"},ct={class:"date-range"},pt={class:"date-item"},mt={class:"date-value"},kt={class:"date-item"},vt={class:"date-value"},gt={key:0,class:"card-section budget-section"},ht={class:"budget-info"},ft={class:"budget-value"},jt={key:1,class:"card-section metadata-section"},Dt={class:"metadata-info"},yt={key:0,class:"metadata-item"},Tt=["innerHTML"],Ft={key:1,class:"metadata-item"},Nt=["innerHTML"],bt={class:"project-tasks-section"},wt={class:"section-header"},Pt={key:0,class:"loading"},_t={key:1,class:"error"},Et={key:2,class:"no-tasks"},Ct={key:3,class:"tasks-list"},Mt={class:"task-header"},xt=["innerHTML"],It={class:"task-meta"},Lt={key:0},St={class:"task-actions"},Vt={key:5,class:"modal"},Bt={class:"modal-content"},Ut={class:"modal-actions"},Ht={key:6,class:"modal"},At={class:"modal-content"},Ot={class:"form-group"},zt={class:"form-group"},qt={class:"form-row"},Rt={class:"form-group"},Gt={class:"form-group"},Jt={class:"form-group"},Kt={class:"modal-actions"};function Qt(i,t,v,h,s,a){const c=f("Button"),T=f("BaseLayout");return r(),P(T,null,{default:_(()=>[e("div",L,[e("div",S,[e("div",{class:"back-button",onClick:t[0]||(t[0]=(...o)=>a.goBack&&a.goBack(...o))},t[24]||(t[24]=[e("i",{class:"fas fa-arrow-left"},null,-1),E(" Back to Projects ")])),s.isEditMode?(r(),n("h1",B,"Edit Project")):(r(),n("h1",{key:0,innerHTML:s.project.name},null,8,V)),s.project.id&&!s.isEditMode?(r(),n("div",U,[p(c,{onClick:t[1]||(t[1]=o=>a.enterEditMode()),variant:"secondary",text:"Edit Project"}),p(c,{onClick:t[2]||(t[2]=o=>a.confirmDeleteProject()),variant:"danger",text:"Delete Project"})])):m("",!0)]),s.loading?(r(),n("div",H,"Loading project details...")):s.error?(r(),n("div",A,d(s.error),1)):!s.project.id&&!s.isEditMode?(r(),n("div",O,"Project not found.")):m("",!0),s.isEditMode?(r(),n("div",z,[e("form",{onSubmit:t[13]||(t[13]=j((...o)=>a.saveProject&&a.saveProject(...o),["prevent"])),class:"project-edit-form"},[e("div",q,[t[25]||(t[25]=e("label",{for:"name"},"Project Name",-1)),l(e("input",{type:"text",id:"name","onUpdate:modelValue":t[3]||(t[3]=o=>s.editForm.name=o),required:""},null,512),[[u,s.editForm.name]])]),e("div",R,[t[26]||(t[26]=e("label",{for:"description"},"Description",-1)),l(e("textarea",{id:"description","onUpdate:modelValue":t[4]||(t[4]=o=>s.editForm.description=o),rows:"4"},null,512),[[u,s.editForm.description]])]),e("div",G,[e("div",J,[t[27]||(t[27]=e("label",{for:"startDate"},"Start Date",-1)),l(e("input",{type:"date",id:"startDate","onUpdate:modelValue":t[5]||(t[5]=o=>s.editForm.startDate=o)},null,512),[[u,s.editForm.startDate]])]),e("div",K,[t[28]||(t[28]=e("label",{for:"endDate"},"End Date",-1)),l(e("input",{type:"date",id:"endDate","onUpdate:modelValue":t[6]||(t[6]=o=>s.editForm.endDate=o)},null,512),[[u,s.editForm.endDate]])])]),e("div",Q,[e("div",W,[t[30]||(t[30]=e("label",{for:"status"},"Status",-1)),l(e("select",{id:"status","onUpdate:modelValue":t[7]||(t[7]=o=>s.editForm.status=o)},t[29]||(t[29]=[e("option",{value:"Not Started"},"Not Started",-1),e("option",{value:"In Progress"},"In Progress",-1),e("option",{value:"On Hold"},"On Hold",-1),e("option",{value:"Complete"},"Complete",-1)]),512),[[D,s.editForm.status]])]),e("div",X,[t[31]||(t[31]=e("label",{for:"completionPercentage"},"Completion (%)",-1)),l(e("input",{type:"number",id:"completionPercentage","onUpdate:modelValue":t[8]||(t[8]=o=>s.editForm.completionPercentage=o),min:"0",max:"100"},null,512),[[u,s.editForm.completionPercentage,void 0,{number:!0}]])])]),e("div",Y,[t[32]||(t[32]=e("label",{for:"budget"},"Budget ($)",-1)),l(e("input",{type:"number",id:"budget","onUpdate:modelValue":t[9]||(t[9]=o=>s.editForm.budget=o),min:"0"},null,512),[[u,s.editForm.budget,void 0,{number:!0}]])]),e("div",Z,[t[35]||(t[35]=e("h3",null,"Project Notes",-1)),e("div",$,[t[33]||(t[33]=e("label",{for:"clientNotes"},"Client Notes",-1)),l(e("textarea",{id:"clientNotes","onUpdate:modelValue":t[10]||(t[10]=o=>s.editForm.clientNotes=o),rows:"3"},null,512),[[u,s.editForm.clientNotes]])]),e("div",tt,[t[34]||(t[34]=e("label",{for:"internalNotes"},"Internal Notes",-1)),l(e("textarea",{id:"internalNotes","onUpdate:modelValue":t[11]||(t[11]=o=>s.editForm.internalNotes=o),rows:"3"},null,512),[[u,s.editForm.internalNotes]])])]),e("div",et,[p(c,{type:"submit",variant:"primary",text:"Save Project"}),p(c,{onClick:t[12]||(t[12]=o=>a.cancelEdit()),variant:"secondary",text:"Cancel"})])],32)])):s.project.id?(r(),n("div",st,[e("div",ot,[e("div",it,[t[36]||(t[36]=e("h3",null,"Description",-1)),e("div",{class:"description",innerHTML:s.project.description},null,8,rt)]),e("div",nt,[t[37]||(t[37]=e("h3",null,"Status",-1)),e("div",at,[e("span",{class:y(["status-badge","status-"+s.project.status.toLowerCase().replace(" ","-")])},d(s.project.status),3),e("div",lt,[e("div",dt,[e("div",{class:"progress",style:C({width:s.project.completionPercentage+"%"})},null,4)]),e("span",null,d(s.project.completionPercentage)+"% Complete",1)])])]),e("div",ut,[t[40]||(t[40]=e("h3",null,"Timeline",-1)),e("div",ct,[e("div",pt,[t[38]||(t[38]=e("span",{class:"date-label"},"Start Date:",-1)),e("span",mt,d(a.formatDate(s.project.startDate)),1)]),e("div",kt,[t[39]||(t[39]=e("span",{class:"date-label"},"End Date:",-1)),e("span",vt,d(a.formatDate(s.project.endDate)),1)])])]),s.project.budget?(r(),n("div",gt,[t[41]||(t[41]=e("h3",null,"Budget",-1)),e("div",ht,[e("span",ft,"$"+d(s.project.budget.toLocaleString()),1)])])):m("",!0),s.project.metadata?(r(),n("div",jt,[t[44]||(t[44]=e("h3",null,"Notes",-1)),e("div",Dt,[s.project.metadata.clientNotes?(r(),n("div",yt,[t[42]||(t[42]=e("h4",null,"Client Notes",-1)),e("div",{innerHTML:s.project.metadata.clientNotes},null,8,Tt)])):m("",!0),s.project.metadata.internalNotes?(r(),n("div",Ft,[t[43]||(t[43]=e("h4",null,"Internal Notes",-1)),e("div",{innerHTML:s.project.metadata.internalNotes},null,8,Nt)])):m("",!0)])])):m("",!0)]),e("div",bt,[e("div",wt,[t[45]||(t[45]=e("h2",null,"Tasks",-1)),p(c,{onClick:t[14]||(t[14]=o=>a.openNewTaskModal()),variant:"primary",text:"Add Task"})]),s.tasksLoading?(r(),n("div",Pt,"Loading tasks...")):s.tasksError?(r(),n("div",_t,d(s.tasksError),1)):s.tasks.length===0?(r(),n("div",Et,t[46]||(t[46]=[e("p",null,"No tasks assigned to this project yet.",-1)]))):(r(),n("div",Ct,[(r(!0),n(M,null,x(s.tasks,o=>(r(),n("div",{key:o.id,class:"task-card"},[e("div",Mt,[e("h3",null,d(o.title),1),e("span",{class:y(["task-status","status-"+o.status.toLowerCase().replace(" ","-")])},d(o.status),3)]),e("div",{class:"task-description",innerHTML:o.description},null,8,xt),e("div",It,[e("span",null,"Due: "+d(a.formatDate(o.dueDate)),1),o.assignedTo?(r(),n("span",Lt,"Assigned to: "+d(o.assignedTo),1)):m("",!0)]),e("div",St,[p(c,{onClick:F=>a.editTask(o),variant:"secondary",text:"Edit",size:"small"},null,8,["onClick"]),p(c,{onClick:F=>a.deleteTask(o.id),variant:"danger",text:"Delete",size:"small"},null,8,["onClick"])])]))),128))]))])])):m("",!0),s.showDeleteConfirm?(r(),n("div",Vt,[e("div",Bt,[t[47]||(t[47]=e("h3",null,"Confirm Delete",-1)),e("p",null,'Are you sure you want to delete "'+d(s.project.name)+'"? This action cannot be undone.',1),e("div",Ut,[p(c,{onClick:t[15]||(t[15]=o=>a.deleteProject()),variant:"danger",text:"Delete"}),p(c,{onClick:t[16]||(t[16]=o=>s.showDeleteConfirm=!1),variant:"secondary",text:"Cancel"})])])])):m("",!0),s.showTaskModal?(r(),n("div",Ht,[e("div",At,[e("h3",null,d(s.editingTask?"Edit Task":"Add New Task"),1),e("form",{onSubmit:t[23]||(t[23]=j((...o)=>a.saveTask&&a.saveTask(...o),["prevent"]))},[e("div",Ot,[t[48]||(t[48]=e("label",{for:"taskTitle"},"Title",-1)),l(e("input",{type:"text",id:"taskTitle","onUpdate:modelValue":t[17]||(t[17]=o=>s.taskForm.title=o),required:""},null,512),[[u,s.taskForm.title]])]),e("div",zt,[t[49]||(t[49]=e("label",{for:"taskDescription"},"Description",-1)),l(e("textarea",{id:"taskDescription","onUpdate:modelValue":t[18]||(t[18]=o=>s.taskForm.description=o),rows:"3"},null,512),[[u,s.taskForm.description]])]),e("div",qt,[e("div",Rt,[t[51]||(t[51]=e("label",{for:"taskStatus"},"Status",-1)),l(e("select",{id:"taskStatus","onUpdate:modelValue":t[19]||(t[19]=o=>s.taskForm.status=o)},t[50]||(t[50]=[e("option",{value:"Not Started"},"Not Started",-1),e("option",{value:"In Progress"},"In Progress",-1),e("option",{value:"On Hold"},"On Hold",-1),e("option",{value:"Complete"},"Complete",-1)]),512),[[D,s.taskForm.status]])]),e("div",Gt,[t[52]||(t[52]=e("label",{for:"taskDueDate"},"Due Date",-1)),l(e("input",{type:"date",id:"taskDueDate","onUpdate:modelValue":t[20]||(t[20]=o=>s.taskForm.dueDate=o)},null,512),[[u,s.taskForm.dueDate]])])]),e("div",Jt,[t[53]||(t[53]=e("label",{for:"taskAssignedTo"},"Assigned To",-1)),l(e("input",{type:"text",id:"taskAssignedTo","onUpdate:modelValue":t[21]||(t[21]=o=>s.taskForm.assignedTo=o)},null,512),[[u,s.taskForm.assignedTo]])]),e("div",Kt,[p(c,{type:"submit",variant:"primary",text:s.editingTask?"Update Task":"Create Task"},null,8,["text"]),p(c,{onClick:t[22]||(t[22]=o=>a.closeTaskModal()),variant:"secondary",text:"Cancel"})])],32)])])):m("",!0)])]),_:1})}const Xt=N(I,[["render",Qt],["__scopeId","data-v-0a88c567"]]);export{Xt as default};
